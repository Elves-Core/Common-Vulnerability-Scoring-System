(function(){

var x, h='', r;

function init()
{
    var I = document.querySelector('iframe'), D;
    if(!I && (D=document.getElementById('hashframe'))) {
        r = false;
        I = document.createElement('iframe');
        I.className='full-frame';
        h=window.location.hash;
        I.src='https://'+window.location.hostname+'/cvss/calculator/cvsscalc40'+((h && h.substr(0, 1)=='#') ?h :'#'+h);
        D.setAttribute('id', 'hashframe-loaded');
        D.appendChild(I);
        setTimeout(init, 500);
        return;
    }
    if(!I) return;
    x = ('contentWindow' in I) ?I.contentWindow :window.frames[0];
    if(!x) return;
    addEvent(window, 'hashchange', toFrame);
    addEvent(x, 'hashchange', toWindow);
    r = true;
    toFrame();
}

function doR()
{
    r = true;
}

function toFrame()
{
    if(r && x.location.href.search(/^https:/)<0) return setTimeout(toFrame, 100);
    if(r && window.location.hash!=x.location.hash && window.location.hash!=h) {
        r = false;
        //console.log('changing iframe to '+window.location.hash);
        x.location.hash = h = window.location.hash;
        setTimeout(doR, 100);
    }
}

function toWindow()
{
    if(r && window.location.hash!=x.location.hash && x.location.hash!=h) {
        r = false;
        //console.log('changing window to '+x.location.hash);
        window.location.hash = h = x.location.hash;
        setTimeout(doR, 100);
    }
}

function addEvent(o, tg, fn) {
    if (o.addEventListener) {
        o.addEventListener(tg, fn, false);
    } else if (o.attachEvent) {
        o.attachEvent('on'+tg, fn);
    } else {
        o['on'+tg] = fn;
    }
};



init();
})()